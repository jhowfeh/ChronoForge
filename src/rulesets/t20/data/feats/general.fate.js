// src/modules/CharSheetT20/services/features/general.fate.js
import { makeFeature, FeatureKind } from './_schema';
import { all, any, attrMin, levelMin, trained, prof, has, castsSpells } from './_prereq';

export const generalFateFeatures = [
  makeFeature({
    id: 'general.fate.acrobatico',
    name: "Acrobático",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você pode usar sua Destreza em vez de Força em testes de Atletismo. Além disso, terreno difícil não reduz seu deslocamento nem o impede de realizar investidas. Pré-requisito: Des 2.",
    prerequisites: [attrMin('DEX', 2)],
  }),
  makeFeature({
    id: 'general.fate.ao_sabor_do_destino',
    name: "Ao Sabor do Destino",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Confiando em suas próprias habilidades (ou em sua própria sorte), você abre mão de usar itens mágicos. Sua autoconfiança fornece diversos benefícios por nível (ver descrição completa). Se você utilizar voluntariamente qualquer item mágico (exceto poções), perde o benefício deste poder até o fim da aventura. Pré-requisito: 6º nível de personagem.",
    prerequisites: [levelMin(6)],
    effects: [{"type": "RULE_NOTE", "title": "Tabela", "text": "Benefícios por nível (6,7,8,9,11,12,13,14,16,17,18,19). Se quiser automatizar, crie effects.PROGRESSION_TABLE."}, {"type": "RULE_NOTE", "title": "Restrição", "text": "Ao usar voluntariamente item mágico (exceto poções), perde o benefício até o fim da aventura."}],
  }),
  makeFeature({
    id: 'general.fate.aparencia_inofensiva',
    name: "Aparência Inofensiva",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "A primeira criatura inteligente que atacar você em uma cena deve fazer um teste de Vontade (CD Car). Se falhar, perderá sua ação. Funciona apenas uma vez por cena. Pré-requisito: Car 1.",
    prerequisites: [attrMin('CHA', 1)],
  }),
  makeFeature({
    id: 'general.fate.atletico',
    name: "Atlético",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +2 em Atletismo e +3m em seu deslocamento. Pré-requisito: For 2.",
    prerequisites: [attrMin('STR', 2)],
  }),
  makeFeature({
    id: 'general.fate.atraente',
    name: "Atraente",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +2 em testes de perícias baseadas em Carisma contra criaturas que possam se sentir fisicamente atraídas por você. Pré-requisito: Car 1.",
    prerequisites: [attrMin('CHA', 1)],
  }),
  makeFeature({
    id: 'general.fate.comandar',
    name: "Comandar",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você pode gastar uma ação de movimento e 1 PM para gritar ordens para seus aliados em alcance médio. Eles recebem +1 em testes de perícia até o fim da cena. Pré-requisito: Car 1.",
    prerequisites: [attrMin('CHA', 1)],
    once: {"per": "scene", "costPM": 1},
  }),
  makeFeature({
    id: 'general.fate.costas_largas',
    name: "Costas Largas",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Seu limite de carga aumenta em 5 espaços e você pode se beneficiar de um item vestido adicional. Pré-requisitos: Con 1, For 1.",
    prerequisites: [attrMin('CON', 1), attrMin('STR', 1)],
  }),
  makeFeature({
    id: 'general.fate.foco_em_pericia',
    name: "Foco em Perícia",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Escolha uma perícia. Quando faz um teste dessa perícia, você pode gastar 1 PM para rolar dois dados e usar o melhor resultado. Pode escolher este poder outras vezes. Este poder não pode ser aplicado em Luta e Pontaria. Pré-requisito: treinado na perícia escolhida.",
    prerequisites: [],
    choiceRules: [{"key": "chosenSkill", "type": "PICK_SKILLS", "count": 1, "filters": {"trainedOnly": true, "exclude": ["luta", "pontaria"]}}],
    once: {"per": "check", "costPM": 1},
  }),
  makeFeature({
    id: 'general.fate.inventario_organizado',
    name: "Inventário Organizado",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você soma sua Inteligência no limite de espaços que pode carregar. Para você, itens muito leves ou pequenos (meio espaço) ocupam 1/4 de espaço. Pré-requisito: Int 1.",
    prerequisites: [attrMin('INT', 1)],
  }),
  makeFeature({
    id: 'general.fate.investigador',
    name: "Investigador",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +2 em Investigação e soma sua Inteligência em Intuição. Pré-requisito: Int 1.",
    prerequisites: [attrMin('INT', 1)],
  }),
  makeFeature({
    id: 'general.fate.lobo_solitario',
    name: "Lobo Solitário",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +1 em testes de perícia e Defesa se estiver sem nenhum aliado em alcance curto. Você não sofre penalidade por usar Cura em si mesmo.",
    prerequisites: [],
  }),
  makeFeature({
    id: 'general.fate.medicina',
    name: "Medicina",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você pode gastar uma ação completa para fazer um teste de Cura (CD 15) em uma criatura. Se passar, ela recupera 1d6 PV +1d6 por cada 5 acima da CD. 1 vez por dia por criatura. Pré-requisitos: Sab 1, treinado em Cura.",
    prerequisites: [attrMin('WIS', 1), trained('cura')],
  }),
  makeFeature({
    id: 'general.fate.parceiro',
    name: "Parceiro",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você possui um parceiro animal ou humanoide (iniciante). Se perder, recebe outro no início da próxima aventura. Pré-requisitos: treinado em Adestramento (animal) ou Diplomacia (humanoide), 5º nível de personagem.",
    prerequisites: [levelMin(5), any(trained('adestramento'), trained('diplomacia'))],
    choiceRules: [{"key": "partnerType", "type": "PICK_PROFICIENCY", "count": 1, "options": ["partner:animal", "partner:humanoid"]}],
  }),
  makeFeature({
    id: 'general.fate.sentidos_agucados',
    name: "Sentidos Aguçados",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +2 em Percepção, não fica desprevenido contra inimigos que não possa ver e re-rola chance de falha de camuflagem uma vez quando erra por camuflagem. Pré-requisitos: Sab 1, treinado em Percepção.",
    prerequisites: [attrMin('WIS', 1), trained('percepcao')],
  }),
  makeFeature({
    id: 'general.fate.sortudo',
    name: "Sortudo",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você pode gastar 3 PM para rolar novamente um teste recém realizado (apenas uma vez por teste).",
    prerequisites: [],
    once: {"per": "check", "costPM": 3},
  }),
  makeFeature({
    id: 'general.fate.surto_heroico',
    name: "Surto Heroico",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Uma vez por rodada, você pode gastar 5 PM para realizar uma ação padrão ou de movimento adicional.",
    prerequisites: [],
    once: {"per": "round", "limit": 1, "costPM": 5},
  }),
  makeFeature({
    id: 'general.fate.torcida',
    name: "Torcida",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +2 em testes de perícia e Defesa quando tem a torcida a seu favor (criaturas inteligentes em alcance médio só torcendo). Pré-requisito: Car 1.",
    prerequisites: [attrMin('CHA', 1)],
  }),
  makeFeature({
    id: 'general.fate.treinamento_em_pericia',
    name: "Treinamento em Perícia",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você se torna treinado em uma perícia a sua escolha. Você pode escolher este poder outras vezes para perícias diferentes.",
    prerequisites: [],
    choiceRules: [{"key": "trainedSkill", "type": "PICK_SKILLS", "count": 1, "filters": {"notTrainedOnly": true}}],
  }),
  makeFeature({
    id: 'general.fate.veneficio',
    name: "Venefício",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Quando usa um veneno, você não corre risco de se envenenar acidentalmente. A CD para resistir aos seus venenos aumenta em +2. Pré-requisito: treinado em Ofício (alquimista).",
    prerequisites: [trained('oficio_alquimista')],
  }),
  makeFeature({
    id: 'general.fate.vontade_de_ferro',
    name: "Vontade de Ferro",
    kind: FeatureKind.GENERAL_FATE,
    group: 'fate',
    source: {"type": "general"},
    text: "Você recebe +1 PM para cada dois níveis de personagem e +2 em Vontade. Pré-requisito: Sab 1.",
    prerequisites: [attrMin('WIS', 1)],
  }),
];